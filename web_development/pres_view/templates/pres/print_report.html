<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Activity Financial Statement</title>
    <style>
      .header-university {
        font-weight: normal;
        font-family: "Old English Text MT", "Times New Roman", serif;
        letter-spacing: 0.5px;
        text-transform: none;
        font-size: 14pt;
      }

      :root {
        --font-main: "Times New Roman", serif;
        --blue-text: #0070c0;
        --gray-header: #d9d9d9;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-main);
        font-size: 11pt;
        color: #000;
        margin: 0;
        padding: 0;
      }

      @page {
        size: A4;
        margin: 20mm 20mm 20mm 20mm;
      }

      .page {
        width: 100%;
      }

      /* Header logos + text */
      .header-row {
        display: table;
        width: 100%;
        margin-top: 6mm;
        margin-bottom: 4pt;
      }

      .header-cell {
        display: table-cell;
        vertical-align: middle;
      }

      .header-cell.left,
      .header-cell.right {
        width: 20%;
        text-align: center;
      }

      .header-cell.center {
        width: 60%;
        text-align: center;
        font-size: 11pt;
        line-height: 1.15;
      }

      .header-logo {
        width: 70px;
        height: 70px;
        object-fit: contain;
      }

      .header-center-line {
        margin: 0;
      }

      /* College + Org name */
      .org-title {
        text-align: center;
        margin-top: 6pt;
        margin-bottom: 2pt;
      }

      .org-title .dept-name {
        font-weight: bold;
        color: #000;
      }

      .org-title .org-name {
        font-weight: bold;
        color: var(--blue-text);
      }

      .org-title span {
        display: block;
      }

      .statement-title {
        text-align: center;
        font-weight: bold;
        margin: 4pt 0;
        background: #bfbfbf;
        padding: 2px 0;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 10pt;
      }

      th,
      td {
        border: 1px solid #000;
        padding: 2px 4px;
        vertical-align: middle;
      }

      th {
        background: var(--gray-header);
        text-align: center;
        font-weight: bold;
      }

      .section-label-cell {
        width: 30%;
        font-weight: bold;
      }

      .section-value-cell {
        width: 70%;
        text-align: center;
      }

      .section-heading {
        background: var(--gray-header);
        font-weight: bold;
        text-align: center;
      }

      .summary-table {
        margin-top: 4pt;
      }

      .summary-table td:first-child {
        width: 55%;
      }

      .summary-table td:last-child {
        width: 45%;
        text-align: center;
      }

      .summary-highlight td {
        background: #e7e6e6;
        font-weight: bold;
      }

      .note {
        margin-top: 6pt;
        font-size: 9pt;
      }

      .text-center {
        text-align: center;
      }

      .text-right {
        text-align: center;
      }

      .page-break {
        page-break-after: always;
        margin-top: 20mm;
      }

      .appendix-title {
        text-align: center;
        font-weight: bold;
        margin-top: 10pt;
        margin-bottom: 12pt;
      }

      /* Appendix receipts grid: 2 columns */
      .appendix-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        grid-auto-rows: auto;
        gap: 12pt;
        margin-top: 8pt;
      }

      .receipt-item {
        break-inside: avoid;
        page-break-inside: avoid;
        margin-bottom: 0;
      }

      .receipt-caption {
        font-size: 9pt;
        margin-bottom: 4pt;
      }

      .receipt-image {
        width: 100%;
        height: auto;
        max-height: 260px;
        object-fit: contain;
        border: 1px solid #000;
      }

      @media print {
        html,
        body {
          height: auto;
          overflow: visible;
        }
      }
    </style>
  </head>
  <body onload="window.print()">
    <div class="page">
      <!-- HEADER PAGE 1 -->
      <div class="header-row">
        <div class="header-cell left">
          <img
            src="{{ url_for('pres.static', filename='images/1.png') }}"
            class="header-logo"
            alt="Logo 1"
          />
        </div>
        <div class="header-cell center">
          <p class="header-center-line">Republic of the Philippines</p>
          <p class="header-center-line header-university">
            Laguna State Polytechnic University
          </p>
          <p class="header-center-line">Province of Laguna</p>
        </div>
        <div class="header-cell right">
          <img
            src="{{ url_for('pres.static', filename='images/2.png') }}"
            class="header-logo"
            alt="Logo 2"
          />
        </div>
      </div>

      <!-- College + Org name -->
      <div class="org-title">
        <span class="dept-name">{{college_name}}</span>
        <span class="org-name">{{org_name}}</span>
      </div>

      <div class="statement-title">ACTIVITY FINANCIAL STATEMENT</div>

      <!-- HEADER INFO TABLES -->
      <table style="margin-top: 4pt">
              <!-- HEADER INFO TABLES -->
      <table style="margin-top: 4pt">
        <tr>
          <td class="section-label-cell">Name of Organization:</td>
          <td class="section-value-cell">{{ org_name or '' }}</td>
        </tr>
        <tr>
          <td class="section-label-cell">Name of the Event:</td>
          <td class="section-value-cell">{{ report.event_name or '' }}</td>
        </tr>
        <tr>
          <td class="section-label-cell">Report for the Month of:</td>
          <td class="section-value-cell">{{ report_month_text or '' }}</td>
        </tr>
        <tr>
          <td class="section-label-cell">Date Prepared:</td>
          <td class="section-value-cell">{{ report.date_prepared or '' }}</td>
        </tr>
      </table>

      <table style="margin-top: 2pt; margin-bottom: 6pt">
        <tr>
          <td class="section-label-cell">Financial Report No:</td>
          <td class="section-value-cell">{{ report.report_no or '' }}</td>
        </tr>

      </table>

      <!-- EXPENSES TABLE -->
      <table>
        <tr>
          <td colspan="5" class="section-heading">EXPENSES</td>
        </tr>
        <tr>
          <th>Date Issued</th>
          <th>Quantity</th>
          <th>Particulars</th>
          <th>Description</th>
          <th>Total</th>
        </tr>
        {% for tx in transactions %}
        <tr>
          <td class="text-center">{{ tx.date_issued }}</td>
          <td class="text-center">{{ tx.quantity }}</td>
          <td class="text-center">{{ tx.particulars }}</td>
          <td class="text-center">{{ tx.description }}</td>
          <td class="text-right">
            PHP {{ "%.2f"|format((tx.quantity or 0) * (tx.price or 0)) }}
          </td>
        </tr>
        {% endfor %}
        <tr>
          <tr class="summary-highlight">
            <td colspan="4" class="text-right">
              <strong>Total Amount of Expenses</strong>
            </td>
            <td class="text-right">
              <strong>PHP {{ "%.2f"|format(totalexpense) }}</strong>
            </td>
          </tr>
      </table>

      <!-- INCOME TABLE - SEPARATE AND AFTER EXPENSES -->
      <table style="margin-top: 6pt">
        <tr>
          <td colspan="5" class="section-heading">INCOME</td>
        </tr>
        <tr>
          <th>Date Issued</th>
          <th>Quantity</th>
          <th>Type of Income</th>
          <th>Description</th>
          <th>Price</th>
        </tr>
        {% for income in incomes %}
        <tr>
          <td class="text-center">{{ income.date_issued }}</td>
          <td class="text-center">{{ income.quantity }}</td>
          <td class="text-center">{{ income.income_type }}</td>
          <td class="text-center">{{ income.description }}</td>
          <td class="text-right">PHP {{ "%.2f"|format(income.price or 0) }}</td>
        </tr>
        {% endfor %}

        <tr class="summary-highlight">
          <td colspan="4" class="text-right">
            <strong>Total Amount of Income</strong>
          </td>
          <td class="text-right">
            <strong>PHP {{ "%.2f"|format(total_income) }}</strong>
          </td>
        </tr>
      </table>

      <!-- SUMMARY TABLES -->
      <table class="summary-table" style="margin-top: 6pt">
        <tr style="background: var(--gray-header); font-weight: bold">
          <td>Budget:</td>
          <td>PHP {{ "%.2f"|format(budget) }}</td>
        </tr>
        <tr>
          <td>Total Amount of Expenses:</td>
          <td>PHP {{ "%.2f"|format(totalexpense) }}</td>
        </tr>
        <tr>
          <td>Total Amount of Income:</td>
          <td>PHP {{ "%.2f"|format(total_income) }}</td>
        </tr>
        <tr>
          <td>Reimbursement of Expenses:</td>
          <td>PHP {{ "%.2f"|format(reimbursement) }}</td>
        </tr>
        <tr>
          <td>Previous Remaining Fund:</td>
          <td>PHP {{ "%.2f"|format(previous_fund) }}</td>
        </tr>
      </table>

      <table class="summary-table">
        <tr style="background: var(--gray-header); font-weight: bold">
          <td>Total Remaining Balance:</td>
          <td>PHP {{ "%.2f"|format(remaining) }}</td>
        </tr>
        <tr>
          <td>Budget in Bank:</td>
          <td>PHP {{ "%.2f"|format(report.get("budget_in_the_bank", 0)) }}</td>
        </tr>
      </table>

      <p class="note">*NOTE: See APPENDIX A for receipts.</p>

      <!-- PAGE 2: APPENDIX A - RECEIPTS -->
      {% if receipts %}
      <div class="page-break"></div>
      <div class="header-row">
        <div class="header-cell left">
          <img
            src="{{ url_for('pres.static', filename='images/1.png') }}"
            class="header-logo"
            alt="Logo 1"
          />
        </div>
        <div class="header-cell center">
          <p class="header-center-line">Republic of the Philippines</p>
          <p class="header-center-line header-university">
            Laguna State Polytechnic University
          </p>
          <p class="header-center-line">Province of Laguna</p>
        </div>
        <div class="header-cell right">
          <img
            src="{{ url_for('pres.static', filename='images/2.png') }}"
            class="header-logo"
            alt="Logo 2"
          />
        </div>
      </div>

      <div class="appendix-title">APPENDIX A - RECEIPTS</div>

      <div class="appendix-grid">
        {% for r in receipts %}
        <div class="receipt-item">
          <div class="receipt-caption">
            {{ r.receipt_date or '' }} - {{ r.description or '' }}
          </div>
          {% if r.file_url %}
          <img src="{{ r.file_url }}" alt="Receipt" class="receipt-image" />
          {% endif %}
        </div>
        {% endfor %}
      </div>
      {% endif %}
    </div>
  </body>
</html>
